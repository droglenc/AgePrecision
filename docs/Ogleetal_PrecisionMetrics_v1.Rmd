---
title: "Review of Age Precision Metrics with Recommendations for Future Use"
author: ""
date: ""
header-includes:
  - \usepackage{amssymb,amsmath,amsfonts}
output:
  word_document: 
    reference_docx: TAFS_doublespace_Style.docx
    pandoc_args: [--filter, pandoc-crossref]
csl: american-fisheries-society.csl
bibliography: GeneralResources.bib
---

```{r notes, echo=FALSE, eval=FALSE}
#* one and two hashtags demark the first two levels of headings
#* three hashtags ... title
#* four hashtags ...
#* five and six hashtags were used for authors
#* seven hastags were used for lines like running head
#* eight hashtags was used to make a comment box. 
#* nine hashtags makes a pagebreak

#* Scientific names in bibliography will be mis-capitalized
#* Paragraphs should be indented, but this was problematic after equations

#* Had to put pandoc-crossref into RStudio's pandoc folder and add
#*  pandoc_args: [--filter, pandoc-crossref] to YAML when equations were
#*  numbered, which is no longer the case.
```

```{r setup, echo=FALSE, include=FALSE, message=FALSE}
## General setup
knitr::opts_chunk$set(echo=FALSE, results="hide",message=FALSE,warning=FALSE)
wdir <- here::here()
library(ggplot2)
library(patchwork)
library(dplyr)
source(file.path(wdir,"code","ggplot_theme.R"))  # Get ggplot theme
# figure widths and heights for 1- and 2-column figures
fw1 <- fh1 <- 7.25/2
fw2 <- 7.25
fh2 <- 7.25*(3/4)
# toggle on to save TIFF/PDF files for figures
saveTIFFs <- FALSE
savePDFs <- FALSE
showFigLabels <- TRUE
# setup captioning (need github version ... remotes::install_github('adletaw/captioner')  )
figs <- captioner::captioner(prefix="Figure",suffix=".")

## Helper function
# Simplifies rounding of in-line result values
RES <- function(x,digits=1) formatC(x,format="f",digits=digits)

## Get data
# Must run LitReview_PREPPER.R script prior to this to retrieve the data from
#   GoogleScholar and wrangle it into the needed format which is printed out to
#   the LR RDATA file that is read in below.
load(file.path(wdir,"data","LitReview.RData"))

# data.frame of individual publications (not by precision estimate) ... includes ...
#   variables that identify which metrics were used
LRBS <- LR %>%
  group_by(studyID,pubyear,pubyear5,country,continent,USA) %>%
  summarize(across(c(APE,ACV,APE2,ACV2,AD,AAD,ASD,PA0,PA1),
                   ~!all(is.na(.))),
            checkbias=any(checkbias=="yes"),
            bias_usedplot=any(bias_usedplot=="yes"),
            bias_usedregression=any(bias_usedregression=="yes"),
            bias_usedsymtest=any(bias_usedsymtest=="yes"),
            bias_usedttest=any(bias_usedttest=="yes"),
            bias_usedother=any(bias_usedother=="yes"),
            checkrelage=any(checkrelage=="yes")) %>%
  mutate(PA=PA0 | PA1,
         PA_alone=ifelse(!PA,NA,!(APE | ACV | AD)),
         PA_with=ifelse(!PA,NA,(APE | ACV | AD)),
         APE_noACV=ifelse(!APE,NA,APE & !ACV),
         APE_wACV=ifelse(!APE,NA,APE & ACV),
         ACV_noAPE=ifelse(!ACV,NA,ACV & !APE),
         ACV_wAPE=ifelse(!ACV,NA,ACV & APE),
         AD_alone=ifelse(!AD,NA,!(APE | ACV)),
         AD_wAPEorACV=ifelse(!AD,NA,(APE | ACV))) %>%
  ungroup()
```

##### Derek H. Ogle
###### Department of Mathematical Sciences, Northland College, 1411 Ellis Ave, Ashland, WI 54806

##### Joshua XX. Lyons
###### Department of Natural Resources, Northland College, 1411 Ellis Ave, Ashland, WI 54806

##### Gordon S. Scott
###### Department of Natural Resources, Northland College, 1411 Ellis Ave, Ashland, WI 54806

####### Running head: Age Precision Metrics Review


#########

# Abstract

######## WILL BE <300 WORDS HERE


#########

# Introduction

Age, along with length, is one of the most important characterisitics of individual fish recorded by fisheries scientists. Age data is used to estimate growth, mortality, and recruitment [@spurgeonGlobalStatusFreshwater2015; @kernsHistoryImportanceAge2017; @quistAgeGrowthFishes2017], which are primary rates of interest for fisheries scientists [@rickerComputationInterpretationBiological1975; @hilbornQuantitativeFisheriesStock1992; @haddonModellingQuantitativeMethods2011; @paukertAgeStructure2017], and in age-structured population models to estimate yield and set harvest regulations [@bevertonDynamicsExploitedFish1957; @hilbornQuantitativeFisheriesStock1992; @haddonModellingQuantitativeMethods2011; @methotStockSynthesisBiological2013]. Age, unlike length, is not directly observed but is most often interpreted from periods of fast and slow growth recorded on calcified structures such as scales, otoliths, fin rays or spines, or vertebrae [@campanaAccuracyPrecisionQuality2001; @spurgeonGlobalStatusFreshwater2015; @quistAgeGrowthFishes2017]. Age data can be highly variable and prone to errors as age may not be reliably recorded on or interpreted from calcified structures, especially for fish that are more than only a few years old [@campanaAccuracyPrecisionQuality2001; @quistAgeGrowth2012; @phelpsChoiceStructureEstimating2017]. Errors in age data have resulted in incorrect estimates of growth, mortality, and recruitment which have led to misunderstanding the population dynamics of some fish populations [@linlaiEffectsAgeingErrors1987; @reevesSimulationStudyImplications2003; @bertignacConsequencesBiasAge2007; @yuleHowSystematicAge2008; @koenigsImpactsAgingError2013; @hamelVariabilityAgeEstimation2016; @tyszko_comparing_2017; @changEvaluationEffectsOtolith2019].

Sources of error in age estimation may be inherent to the calcified structure itself or part of the process of interpreting age from the calcified structure [@campanaAccuracyPrecisionQuality2001; @morisonQualityIssuesUse2005; @buckmeierValidationAnnualDaily2017]. Errors inherent to the structure are measurable, but cannot be controlled [@morisonQualityIssuesUse2005]. Assessing this source of error is part of validating ages estimated from calcified structures, methods for which have been thoroughly reviewed [@maceinaCurrentStatusReview2007; @spurgeonGlobalStatusFreshwater2015; @buckmeierValidationAnnualDaily2017] and are not addressed further here. Errors related to the process of interpreting ages can be both measured and controlled [@morisonQualityIssuesUse2005] and consist of differences between the estimated and true age (i.e., accuracy) and differences among estimated ages from multiple interpretations of the same structure (either by multiple interpreters or the same interpreter multiple times). Differences among interpretations of the same structure may be systematic (e.g., one set of ages is always one year less than the other set of ages), patterned (e.g., one set of ages largely match the other set of ages up to a certain age and then become progressively more different after that age), or random. Identifying or measuring systematic or patterned differences among interpretations is referred to as identifying *bias* (or not) in the age estimates [@campanaGraphicalStatisticalMethods1995]. Methods for assessing bias are described by @campanaGraphicalStatisticalMethods1995 and are also not discussed further here. In the absence of bias, *precision* is a measure of random differences among interpretations, or the repeatability of age estimates among interpreters [@campanaAccuracyPrecisionQuality2001; @maceinaCurrentStatusReview2007] that do not display a bias [@campanaGraphicalStatisticalMethods1995]. Precision and metrics for assessing precision are the focus this paper.

Precision metrics measure the repeatability of $R$ age estimates made on each of $n$ individual fish. Percent agreement, the simplest precision metric, is the percentage of $n$ fish for which the $R$ age estimates are the same (i.e., *exact percent agreement*) or differ by no more than a certain amount (e.g., differ by no more than one year). When $R\!>\!2$, *percent partial agreement* is the percentage of $n$ fish for which the age estimates agree for some specific number of interpreters (e.g., at least two interpreters agree). For our purposes we do not differentiate between the percent agreement types and will only consider whether at least one of the *percent agreement* ($PA$) metrics was used or not.

Other measures of precision result from computing various measures of variability among the $R$ age estimates within each of the $j$ fish and then averaging these values across the $n$ fish. The first two measures of variability are the familiar absolute deviation (AD) and standard deviation (SD) of estimated ages for each fish; i.e., 

$$AD_{j} = \frac{\sum_{i=1}^{R}\,\left|x_{ij}-\bar{x}_{j}\right|}{R}$$

$$SD_{j} = \sqrt{\frac{\sum_{i=1}^{R}\,\left(x_{ij}-\bar{x}_{j}\right)^{2}}{R-1}}$$

where $x_{ij}$ is the $i$th age estimate for the $j$th fish and $\bar{x}_{j}$ is the mean of the $R$ age estimates for the $j$th fish. The $AD_{j}$ and $SD_{j}$ may be scaled by $\bar{x}_{j}$ to produce the percent error (PE) and coefficient of variation (CV) for the $j$th fish, respectively; i.e., 

$$PE_{j} = \frac{AD_{j}}{\bar{x}_{j}}$$

$$CV_{j} = \frac{SD_{j}}{\bar{x}_{j}}$$

When $PE_{j}$ and $CV_{j}$ are averaged across all $n$ fish they produce the overall measures of precision called *average percent error* [$APE$; @beamishMethodComparingPrecision1981] and *average coefficient of variation* [$ACV$; @changStatisticalMethodEvaluating1982]. These measures are usually multiplied by 100 and expressed as a percentage; i.e.,

$$APE = 100\times\frac{\sum_{j=1}^{n}\, PE_{j}}{n}$$

$$ACV = 100\times\frac{\sum_{j=1}^{n}\, CV_{j}}{n}$$

When $R\!=\!2$, $ACV=\sqrt{2}APE$ [@changStatisticalMethodEvaluating1982; @kimuraQualityControlAge2005] and, thus, $ACV$ and $APE$ only differ by a constant value and provide functionally the same information about precision among age estimates. For $R\!>\!2$, $PE_{j}$ is proportional to $CV_{j}$ [@changStatisticalMethodEvaluating1982]. However, this proportionality depends on $\bar{x}_{j}$ and, thus, there is no constant proportionality between $APE$ and $ACV$, though they are likely to be strongly correlated [@kimuraQualityControlAge2005].

Percent agreement, $APE$, and $ACV$ are the most commonly used measures of precision [@campanaAccuracyPrecisionQuality2001; @morisonQualityIssuesUse2005]. Percent agreement has been criticized as a useful composite measure of precision, largely because it varies widely among species and among ages within a species [@beamishMethodComparingPrecision1981; @kimuraBetweenreaderBiasVariability1991; @campanaGraphicalStatisticalMethods1995; @campanaAccuracyPrecisionQuality2001; @maceinaCurrentStatusReview2007]. Despite these critiques and likely due to its simplicity, @morisonQualityIssuesUse2005 found that 49% of 53 laboratories from 23 countries used percent agreement as a measure of precision among estimated ages. @beamishMethodComparingPrecision1981 proposed the $APE$ to address the shortcomings of the percent agreement. @changStatisticalMethodEvaluating1982 introduced $ACV$, though he called it $CV$, as a better alternative to the $APE$ because the standard deviation is a better estimator (unbiased and consistent) of variability than the absolute deviation, though @kimuraBetweenreaderBiasVariability1991 noted that this was only true if the age estimates were normally distributed.

In a review of 131 publications that reported precision values for fish age estimates, @campanaAccuracyPrecisionQuality2001 found that most authors used the $ACV$ (57%) to measure precision, though $APE$ and $ACV$ were used almost equally for studies of annual age and $ACV$ was used predominantly (84%) when estimating daily age from otoliths. The median and modal $ACV$ across 117 studies deemed to have valid precision estimates were 7.6% and 5%, respectively. No significant differences in precision were found among calcified structures used to estimate annual age. @campanaAccuracyPrecisionQuality2001 did, however, specifically mention differences between structures and between taxonomic classes of fish; e.g., "(v)irtually all studies reporting shark ages based on vertebrae did so with CV values exceeding 10%, while the most frequently reported CV for otoliths was 5%." @campanaAccuracyPrecisionQuality2001 reiterated that there is a direct conversion between $ACV$ and $APE$ when $R\!=\!2$ and that both measures are "equally sensitive to precision differences among agers." From this, @campanaAccuracyPrecisionQuality2001 stated that "it is not self-evident that one measure [APE or ACV] is to be preferred over the other." However, from his literature review and informal discussions with scientists from fish ageing laboratories, @campanaAccuracyPrecisionQuality2001 concluded that an $ACV$ of 5% would represent reasonable precision for many fish of moderate longevity and complexity of structure interpretation.

Other metrics of precision have been proposed or could be derived using similar logic. @changStatisticalMethodEvaluating1982 also introduced the index of precision for the $j$th fish as $D_{j}=\frac{ACV_{j}}{\sqrt{R}}$. @kimuraQualityControlAge2005 suggested, based on distributional theory, that the median age estimate for the $j$th fish ($\tilde{x}_{j}$) should be used instead of $\bar{x}_{j}$ for $PE_{j}$. Presumably the same argument could be applied to $CV_{j}$. This change results in a modified percent error and coefficient of variation for the $j$th fish; i.e., 

$$PE_{j}^{*} = \frac{\frac{\sum_{i=1}^{R}\,\left|x_{ij}-\tilde{x}_{j}\right|}{R}}{\tilde{x}_{j}}$$

$$CV_{j}^{*} = \frac{\sqrt{\frac{\sum_{i=1}^{R}\,\left(x_{ij}-\bar{x}_{j}\right)^{2}}{R-1}}}{\tilde{x}_{j}}$$ 

@bauerlienPrecisionCalcifiedStructures2018] suggested that if the variability among age estimates is not related to the age of the fish then $AD_{j}$ may be an appropriate measure of variability, as compared to $PE_{j}$. Similar arguments suggest that $SD_{j}$ may be an appropriate measure of variability as compared to $CV_{j}$. Averaging these measures across all $n$ fish gives five alternative measures of precision among age estimates -- *average index of precision* [$D$; @changStatisticalMethodEvaluating1982], *average modified percent error* ($APE^{*}$), *average modified coefficient of variation* ($ACV^{*}$), *average absolute deviation* [$AAD$; @bauerlienPrecisionCalcifiedStructures2018], and *average standard deviation* ($ASD$). All but the $AAD$ and $ASD$ are typically multiplied by 100 and reported as a percentage.

Not suprisingly there are predictable relationships between several of these measures. When $R\!=\!2$, $ASD=\sqrt{2}\times AAD$, $ACV=ACV^{*}$ and $APE=APE^{*}$ because $\bar{x}_{j}=\tilde{x}_{j}$, and $APE=D$ [@campanaGraphicalStatisticalMethods1995]. Thus, when $R\!=\!2$, $ACV$, $APE$, $ACV^{*}$, $APE^{*}$, and $D$ provide either the same or functionally the same information about precision among age estimates. Similarly, $AAD$ and $ASD$ provide functionally the same information about precision among $R\!=\!2$ age estimates. For $R\!>\!2$, $ACV$ and $D$ are proportional and, thus, do not provide functionally different information about precision among age estimates.

It has been more than two decades since @campanaAccuracyPrecisionQuality2001 reviewed the use of precision metrics in the published literature and made recommendation for their use. It has also been 15 years since @maceinaCurrentStatusReview2007 reported on a survey of fisheries scientists with respect to their use of precision metrics. In relatively recent years, @bauerlienPrecisionCalcifiedStructures2018 suggested that using a single summary precision metric may not be good practice and @buckmeierValidationAnnualDaily2017 described how the ASD may be more appropriate than the $ACV$ in some instances. Given the length of time since the last synthetic review of precision metrics and these newly raised questions, we report here on our comprehensive review of papers published since 1996 that reported age precision metrics for fish. Our overall goal with this review is to summarize the use of precision metrics since @campanaAccuracyPrecisionQuality2001. Specifically, we aim to answer the following questions.

1. Has the frequency of published precision estimates changed since 1996?
1. Have there been any notable changes in the frequency of characteristics of the precision metric studies (e.g., in $R$, between- or within-interpreter comparison types, type of calcified structure) since 1996?
1. How often did the authors check for no bias in age estimates among interpretations before computing the precision metric?
1. How often did the authors check for a relationship between the precision metric and age?
1. How often were each of the seven precision metrics introduced above used?
1. Has the frequency of use for the three main precision metrics ($ACV$, $APE$, $PA$) changed since 1996?
1. What is the distribution of $ACV$ values reported in the literature?
1. Do $ACV$ values reported in the literature differ by taxonomic class, calcified structure, number of repeated interpretations (i.e., $R$), type of comparison (between- or within-interpreter), maximum estimated age, number of age interpretations, or structure preparation method.

Under the *a priori* assumptions that only $PA$, $APE$, and $ACV$ were used extensively, few papers will have tested for bias prior to computing the precision metric, and few papers will have tested for a relationship between the precision metric and age, we performed additional analyses of multiple age estimates provided by publication authors. Specifically with these additional analyses we aim to answer the following questions:

9. How often is a bias detected (and, thus, an overall measure of precision should not be calculated)?
1. How are the various precision metrics related (beyond the known relationships identified above)?
1. How often is each precision metric related to age?
1. When a precision metric is related to age, what is the form of that relationship?


# [A]Methods
[C]*Literature Review.*-- We collected precision metric information from a non-random set of published papers so as to maximize temporal, spatial, taxonomic, and methodological coverage. An initial sample of publications was gathered using GoogleScholar with the search terms "fish" and "precision" coupled with other terms such as "age", "otolith", and "vertebrae." This sample was augmented by searching for publications in specific journals that often publish fish age precision studies (e.g., North American Journal of Fisheries Management, Journal of Ichthyology), searching ResearchGate, mining the references of previously selected publications, and including publications that we became aware of in other ways. Publications for which we could not access the full text, were not written in English, focused only on daily ages, only provided precision metrics across structures (e.g., between scales and otoliths), or did not report precision metric results were excluded.

Our primary sampling unit is the publication and our secondary sampling unit is an individual assessment of precision within each publication. Thus, more than one measure of precision may have been recorded from a single publication. For example, two sets of results (described below) were recorded if precision between interpreters was reported for each of two calcified structures (e.g., scales and otoliths), two sets of results were recorded if precision between interpreters was reported for one calcified structure for two species, or two sets of results were recorded if precision within one interpreter was recorded for one calcified structure for one species on two different water bodies. Results were not recorded if the precision metric was not reported, was clearly in error, or was a summary (i.e., average) across groups of fish.

For each precision assessment we recorded the precision metric(s) used (e.g., $PA$, $APE$, $ACV$), observed value(s) for each metric, taxonomic species and class of fish examined, calcified structure (e.g., otolith, vertebrae) used for estimating age, methodology for preparing the structure for ageing (e.g., sectioned/ground, whole), type of comparison made (between- or within-interpreters), number of repeated age interpretations ($R$), number of fish with age estimates ($n$), maximum estimated age, and range of estimated ages. Numbers of fish with age estimates, maximum estimated age, and range of estimated ages were approximated from figures for some assessments. Assessments were excluded from further analysis when $R$=2 and both $ACV$ and $APE$ were reported, but the $ACV$ to $APE$ ratio was not $\sqrt{2}$ within rounding. To increase the number of observed $ACV$ values for subsequent summarization, assessments with only $APE$ results were converted to $ACV$ results when $R$=2 with $ACV=\sqrt{2}APE$. For each publication we recorded the year of publication, the country of the lead author, whether or not $PA$ was used alone or with either the $ACV$ or $APE$ (assuming $PA$ was used), whether or not the $ACV$ was used alone or with the $APE$ (assuming $ACV$ was used), whether or not the $APE$ was used alone or with the $ACV$ (assuming $APE$ was used), whether or not the authors checked for bias among interpretations of estimated age and, if they checked for bias, which method they used to check for bias (e.g., age-bias plot, symmetry test), and whether or not they checked for a relationship between precision metric values and estimated age.

Tests with categorical response (e.g., $R$) and categorical explanatory (e.g., calcified structure) variables were conducted with a chi-square test with potential post-hoc comparisons made with multiple chi-squares tests for each pair of levels of the explanatory variable using the Benjamini-Holberg-Yekutieli (BHY) false discovery rate method to correct for multiple comparisons [@benjamini_controlling_1995;@benjamini_control_2001]. Differences in median values of quantitative response variables (e.g., $ACV$) among levels of categorical explanatory variables (e.g., calcified structure) were examined with a Kruskal-Wallis test followed by Dunn's test [@dunn_multiple_1961; @dunn_multiple_1964] using the BHY method for multiple comparisons. Relationships between quantitative response (e.g., $ACV$) and quantitative explanatory variables (e.g., maximum age) were assessed with a general additive model [@wood_generalized_2017] using a smoothing term on the explanatory variable. All analyses were performed in R v4.1.0 [@r_core_team_r_2021] using dunnTest() from the FSA v0.9.0 package [@ogle_fsa_2021], gam() from the mgcv v1.8-36 package [@wood_generalized_2017], and $\alpha$=0.05.


[C]*Extended Analyses.*-- XXX




# [A]Results
## [B]Literature Review

```{r CALC_n}
## Overall sample sizes (first number of assessments, then number of publications)
LR_n <- nrow(LR)
LRBS_n <- nrow(LRBS)

## Number of species and families
n_species <- length(unique(LR$species))
n_families <- length(unique(LR$family))

## Number of countries for lead author
n_countries <- length(unique(LRBS$country))

## Number of studies by country
SUMLRBS_n_country <- LRBS %>%
  group_by(country) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100) %>%
  arrange(desc(freq))

## Number of studies by continent
SUMLRBS_n_continent <- LRBS %>%
  group_by(continent,USA) %>%
  summarize(freq=n())
```
```{r CALC_n_by_year}
## Number of assessments by year and 5-year period
SUMLR_n_years <- LR %>%
  group_by(pubyear5,pubyear) %>%
  summarize(n=n())

SUMLR_n_years5 <- SUMLR_n_years %>%
  summarize(minyr=min(pubyear),
            maxyr=max(pubyear),
            maxn=max(n),
            n_ests=sum(n))

## Number of publications by year and 5-year period
SUMLRBS_n_years <- LRBS %>%
  group_by(pubyear5,pubyear) %>%
  summarize(n=n())
SUMLRBS_n_years5 <- SUMLRBS_n_years %>%
  summarize(n_pubs=sum(n))

## Number of assessments and publications by 5-year period (for Figure_n_by_year)
SUM_n_years5 <- left_join(SUMLR_n_years5,SUMLRBS_n_years5) %>%
  mutate(nlbl=paste0(n_ests," assessments in\n",n_pubs," publications"))
SUM_n_years5
```
```{r CALC_n_by_class_structure}
## Number of assessments by taxonomic class
xclass <- xtabs(~class,data=LR)
#  Removed holocephali and petromyzonti for further summaries because small n

SUMLR_n_class_strux <- LR %>%
  filter(class %in% c("Actinopteri","Elasmobranchii")) %>%
  group_by(class,structure) %>%
  summarize(n=n()) %>%
  mutate(Percent=n/sum(n)*100,
         plbl=paste0(formatC(Percent,format="f",digits=0),"%")) %>%
  ungroup()
```
```{r CALC_n_by_class_structure_year5}
## Number of assessments by taxonomic class and structure
#  Removed holocephali and petromyzonti because small n
SUMLR_n_class_strux_year5 <- LR %>%
  filter(class %in% c("Actinopteri","Elasmobranchii")) %>%
  group_by(class,pubyear5,structure) %>%
  summarize(n=n()) %>%
  mutate(Percent=n/sum(n)*100,
         plbl=paste0(formatC(Percent,format="f",digits=0),"%")) %>%
  ungroup()
```
```{r CALC_P_by_type_structure}
## Number of assessments by type of interpretation comparisons (within, between)
xtype <- xtabs(~type,data=LR)
#  Removed "both" because small n

#  Chi-square test to see if type differed by structure
xstruxtype1 <- xtabs(~structure+type,data=droplevels(filter(LR,type!="Both")))
( chistruxtype <- chisq.test(xstruxtype1) )
chistruxtype2 <- NCStats::chisqPostHoc(chistruxtype,control="fdr")
chistruxtype2$comparison[which(chistruxtype2$adj.p<0.05)]

#  Percent between/within within each structure type
SUM_np_strux_type <- LR %>%
  filter(type!="Both") %>%
  group_by(structure,type) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100) %>%
  ungroup()
#  Isolated the betweens and added label texts for plotting
SUM_np_strux_type2 <- SUM_np_strux_type %>%
  filter(type=="Between") %>%
  mutate(lets=c("a","b","b","b","c","a"),
         plbl=paste0(formatC(perc,format="f",digits=0),"%"),
         nlbl=paste0("n=",freq))
```
```{r CALC_Sum_R}
## Number of assessment R (largest group is 4+)
SUMLR_n_R <- LR %>%
  group_by(Rcat4) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100)

## Number of assessments by R by  (with chi-square test when largest is 3+)
xyearR4 <- xtabs(~pubyear5+Rcat4,data=LR)
chisq.test(xyearR4)
xyearR3 <- xtabs(~pubyear5+Rcat3,data=LR)
chiyearR3 <- chisq.test(xyearR3)
chiyearR32 <- NCStats::chisqPostHoc(chiyearR3,control="fdr")
chiyearR32$comparison[which(chiyearR32$adj.p<0.05)]

## Summaries for graph
SUMLR_n_R_year5 <- LR %>%
  group_by(pubyear5,Rcat4) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100)

SUMLR_n_R_year5a <- SUMLR_n_R_year5 %>%
  summarize(freq=sum(freq)) %>%
  mutate(nlbl=paste0("n=",freq))
```

The results from the literature review consisted of `r LR_n` individual precision assessments from `r LRBS_n` papers published between 1996 and 2020. These results contained assessments for `r n_species` species from `r n_families` families and were reported by lead authors from `r n_countries` countries with lead authors from the United States most represented (`r RES(SUMLRBS_n_country$perc[1])`%; `r figs("Figure_n_by_continent",display="cite")`).

The number of papers with precision assessments generally increased over the 25-year period (`r figs("Figure_n_by_year",display="cite")`). Otoliths were the most commonly assessed calcified structure (`r SUMLR_n_class_strux[1,"plbl"]` of all assessments for Actinopteri), though vertebrae were most commonly assessed among elasmobranchs (`r SUMLR_n_class_strux[8,"plbl"]` of all assessments for Elasmobranchii; `r figs("Figure_n_by_class_structure",display="cite")`). The number of precision assessments for Actinopteri increased in the late 2000s, primarily due to increased assessments of scales, spines, and fin rays, and then again in the late 2010s due to more otolith assessments (`r figs("Figure_n_by_class_structure",display="cite")`). The number of precision assessments for Elasmobranchii was fairly constant over the 25 years, though the assessment of spines increased beginning in the late 2000s (`r figs("Figure_n_by_class_structure",display="cite")`). Most precision assessments were between-interpreters rather than within-interpreters for all calcified structures except vertebrae where only `r SUM_np_strux_type2[5,"plbl"]` of assessments were between-interpreters (`r figs("Figure_P_by_type_structure",display="cite")`). The majority of precision assessments were between two interpretations (`r RES(SUMLR_n_R[[1,"perc"]],digits=0)`%; `r figs("Figure_Sum_R",display="cite")`). The percentage of assessments using two interpretations increased to a peak in the late 2000s and decreased into the 2010s, primarily replaced with assessments among three interpretations, though assessments with four or more interpretations were more prevalent in the late 2010s (`r figs("Figure_Sum_R",display="cite")`).


```{r CALC_Bias}
SUMLRBS_checkbias <- LRBS %>%
  summarize(n=n(),
            freq=sum(checkbias)) %>%
  mutate(perc=freq/n*100)
SUMLRBS_checkbias2 <- LRBS %>%
  group_by(pubyear5) %>%
  summarize(n=n(),
            freq=sum(checkbias)) %>%
  mutate(perc=freq/n*100)

SUMLRBS_methods <- LRBS %>%
  summarize(across(c(checkbias,starts_with("bias_used")),sum,na.rm=TRUE)) %>%
  mutate(across(starts_with("bias_used"),~./checkbias*100)) %>%
  select(-checkbias) %>%
  as.data.frame()

SUMLRBS_checkrelage <- LRBS %>%
  summarize(n=n(),
            freq=sum(checkrelage)) %>%
  mutate(perc=freq/n*100)
```

Bias among interpretations was examined for at least one assessment in `r RES(SUMLRBS_checkbias$perc[1],0)`% of publications, with a slight increase from `r RES(SUMLRBS_checkbias2$perc[1],0)`% of publications in 1996-2000 to `r RES(SUMLRBS_checkbias2$perc[5],0)`% of publications in 2016-2020. Of those publications that examined bias, `r RES(SUMLRBS_methods$bias_usedplot[[1]],0)`% used an age bias or age difference plot [@campanaGraphicalStatisticalMethods1995] and `r RES(SUMLRBS_methods$bias_usedsymtest[[1]],0)`% used a symmetry test [@bowker_test_1948; @mcbrideDiagnosisPairedAge2015], sometimes together or with various other methods. The relationship between the value of the precision metric and estimated age was mentioned in `r RES(SUMLRBS_checkrelage$perc[1],0)`% of publications, though this relationship was not formally tested in nearly all of these publications.

```{r CALC_Sum_Metrics}
# Number/Percent metrics used across all STUDIES
SUMLRBS_n_Metrics <- LRBS %>%
  summarize(n=n(),across(c(PA,APE,ACV,APE2,ACV2,AD,AAD,ASD,
                           PA_alone,PA_with,APE_noACV,APE_wACV,
                           ACV_noAPE,ACV_wAPE,AD_alone,AD_wAPEorACV),
                         sum,na.rm=TRUE)) %>%
  as.data.frame()
SUMLRBS_n_Metrics
## ASD and APE* were in only 1 pub each, ACV and AAD were in 0 ... thus removed

SUMLRBS_P_Metrics <- SUMLRBS_n_Metrics %>%
  select(PA,ACV,APE,AD) %>%
  tidyr::pivot_longer(everything(),names_to="Metric",values_to="Freq") %>%
  mutate(Metric=factor(Metric,levels=c("PA","ACV","APE","AD")),
         Percent=Freq/SUMLRBS_n_Metrics$n*100,
         plbl=paste0(formatC(Percent,format="f",digits=0),"%"))
SUMLRBS_P_Metrics

SUMLRBS_P_Metrics2 <- SUMLRBS_n_Metrics %>%
  mutate(PA_alone=PA_alone/PA*100,PA_other=PA_with/PA*100,
         ACV_alone=ACV_noAPE/ACV*100,ACV_other=ACV_wAPE/ACV*100,
         APE_alone=APE_noACV/APE*100,APE_other=APE_wACV/APE*100,
         AD_alone=AD_alone/AD*100,AD_other=AD_wAPEorACV/AD*100) %>%
  select(contains(c("alone","other"))) %>%
  tidyr::pivot_longer(everything(),values_to="Percent") %>%
  mutate(Metric=sub("_.*","",name),
         Metric=factor(Metric,levels=c("PA","ACV","APE","AD")),
         CUSE=sub(".*_","",name),
         clbl=c("Only\nPA","","Without\nAPE","Without\nACV",
                "With APE,\nACV, or AD","With APE","With ACV","With APE\nor ACV"),
         clbl=paste0(clbl,"\n(",formatC(Percent,format="f",digits=0),"%)"),
         clbly=ifelse(CUSE=="alone",Percent/2,100-Percent+Percent/2)) %>%
  select(Metric,CUSE,Percent,clbl,clbly)
SUMLRBS_P_Metrics2

SUMLRBS_P_Metrics3 <- LRBS %>%
  group_by(pubyear5) %>%
  summarize(n=n(),
            n_APE_noACV=sum(APE_noACV,na.rm=TRUE),
            n_APE=sum(APE),
            n_ACV=sum(ACV)) %>%
  mutate(p_APE_noACV=n_APE_noACV/n*100,
         p_APE=n_APE/n*100,
         p_ACV=n_ACV/n*100) %>%
  select(pubyear5,n,p_APE_noACV,p_APE,p_ACV) %>%
  tidyr::pivot_longer(-(pubyear5:n),names_to="Metric",values_to="Percent")
SUMLRBS_P_Metrics3
```

The $ACV$ was the most used precision metric, though the $APE$ and $PA$ were also commonly used (`r figs("Figure_MetricsUsed",display="cite")`). The $PA$ was most often used simultaneously with either the $ACV$, $APE$, or $AD$ and, thus, was used rarely by itself (`r RES(SUMLRBS_P_Metrics2[[1,"Percent"]],digits=0)`% of publications that used $PA$). The $ACV$ and $APE$ were commonly used together with `r RES(SUMLRBS_P_Metrics2[[6,"Percent"]],digits=0)`% of publications that used $ACV$ also using $APE$ and `r RES(SUMLRBS_P_Metrics2[[7,"Percent"]],digits=0)`% of publications that used $APE$ also using $ACV$. The percent of publications that used the $ACV$ generally increased from 1996 to 2020, whereas the percent of publications that used the $APE$ was fairly steady before increasing in the late 2010s (`r figs("Figure_MetricsUsed_Year",display="cite")`). However, the percent of publications that used the $APE$ without also using the $ACV$ declined to approximately 20% by the early to late 2000s and has stayed steady since then (`r figs("Figure_MetricsUsed_Year",display="cite")`). The $AD$ was used rarely and always with either the $ACV$ or $APE$ (`r figs("Figure_MetricsUsed",display="cite")`). The $AAD$, $ASD$, and $APE^{*}$ were each used in one study, and $ACV^{*}$ was not used in any publications.


```{r CALC_ACVSUM}
LR_ACV_noNA <- filter(LR,!is.na(ACVmod),
                      class %in% c("Actinopteri","Elasmobranchii"),
                      type!="Both")

SUMLR_ACV1 <- LR_ACV_noNA %>%
  summarize(n=n(),
            P1=stats::quantile(ACVmod,probs=0.01),
            P5=stats::quantile(ACVmod,probs=0.05),
            D1=stats::quantile(ACVmod,probs=0.10),
            Q1=stats::quantile(ACVmod,probs=0.25),
            mdn=stats::quantile(ACVmod,probs=0.50),
            Q3=stats::quantile(ACVmod,probs=0.75),
            D9=stats::quantile(ACVmod,probs=0.90),
            P95=stats::quantile(ACVmod,probs=0.95),
            P99=stats::quantile(ACVmod,probs=0.99)) %>%
  mutate(class="All",structure="All",Rcat3="All",type="All")

SUMLR_ACV2 <- LR_ACV_noNA %>%
  group_by(class) %>%
  summarize(n=n(),
            P1=stats::quantile(ACVmod,probs=0.01),
            P5=stats::quantile(ACVmod,probs=0.05),
            D1=stats::quantile(ACVmod,probs=0.10),
            Q1=stats::quantile(ACVmod,probs=0.25),
            mdn=stats::quantile(ACVmod,probs=0.50),
            Q3=stats::quantile(ACVmod,probs=0.75),
            D9=stats::quantile(ACVmod,probs=0.90),
            P95=stats::quantile(ACVmod,probs=0.95),
            P99=stats::quantile(ACVmod,probs=0.99)) %>%
  mutate(structure="All",Rcat3="All",type="All") %>%
  ungroup()

SUMLR_ACV3 <- LR_ACV_noNA %>%
  group_by(class,structure) %>%
  summarize(n=n(),
            P1=stats::quantile(ACVmod,probs=0.01),
            P5=stats::quantile(ACVmod,probs=0.05),
            D1=stats::quantile(ACVmod,probs=0.10),
            Q1=stats::quantile(ACVmod,probs=0.25),
            mdn=stats::quantile(ACVmod,probs=0.50),
            Q3=stats::quantile(ACVmod,probs=0.75),
            D9=stats::quantile(ACVmod,probs=0.90),
            P95=stats::quantile(ACVmod,probs=0.95),
            P99=stats::quantile(ACVmod,probs=0.99)) %>%
  mutate(Rcat3="All",type="All") %>%
  ungroup()

SUMLR_ACV4 <- LR_ACV_noNA %>%
  group_by(class,structure,Rcat3) %>%
  summarize(n=n(),
            P1=stats::quantile(ACVmod,probs=0.01),
            P5=stats::quantile(ACVmod,probs=0.05),
            D1=stats::quantile(ACVmod,probs=0.10),
            Q1=stats::quantile(ACVmod,probs=0.25),
            mdn=stats::quantile(ACVmod,probs=0.50),
            Q3=stats::quantile(ACVmod,probs=0.75),
            D9=stats::quantile(ACVmod,probs=0.90),
            P95=stats::quantile(ACVmod,probs=0.95),
            P99=stats::quantile(ACVmod,probs=0.99)) %>%
  mutate(type="All") %>%
  ungroup()

SUMLR_ACV5 <- LR_ACV_noNA %>%
  group_by(class,structure,Rcat3,type) %>%
  summarize(n=n(),
            P1=stats::quantile(ACVmod,probs=0.01),
            P5=stats::quantile(ACVmod,probs=0.05),
            D1=stats::quantile(ACVmod,probs=0.10),
            Q1=stats::quantile(ACVmod,probs=0.25),
            mdn=stats::quantile(ACVmod,probs=0.50),
            Q3=stats::quantile(ACVmod,probs=0.75),
            D9=stats::quantile(ACVmod,probs=0.90),
            P95=stats::quantile(ACVmod,probs=0.95),
            P99=stats::quantile(ACVmod,probs=0.99)) %>%
  ungroup()

SUMLR_ACV <- bind_rows(SUMLR_ACV1,SUMLR_ACV2,SUMLR_ACV3,SUMLR_ACV4,SUMLR_ACV5) %>%
  relocate(class,structure,Rcat3,type,.before=n) %>%
  mutate(class=factor(class,levels=c("All","Actinopteri","Elasmobranchii")),
         structure=factor(structure,levels=c("All","Otoliths","Scales","Finrays",
                                             "Spines","Vertebrae","Other")),
         Rcat3=factor(Rcat3,levels=c("All","2","3+")),
         type=factor(type,levels=c("All","Between","Within"))) %>%
  arrange(class,structure,Rcat3,type)

SUMLR_ACV_TABLE <- SUMLR_ACV %>%
  rename(`1%`=P1,`5%`=P5,`10%`=D1,`25%`=Q1,`50%`=mdn,
         `75%`=Q3,`90%`=D9,`95%`=P95,`99%`=P99) %>%
  mutate(class=ifelse(class=="All","",as.character(class)),
         structure=ifelse(structure=="All","",as.character(structure)),
         Rcat3=ifelse(Rcat3=="All","",as.character(Rcat3)),
         type=ifelse(type=="All","",as.character(type)),
         class=ifelse(FSA::repeatedRows2Keep(.,"class"),as.character(class),""),
         structure=ifelse(FSA::repeatedRows2Keep(.,"structure"),as.character(structure),""),
         Rcat3=ifelse(FSA::repeatedRows2Keep(.,"Rcat3"),as.character(Rcat3),""))


kruskal.test(ACVmod~structure,data=LR_ACV_noNA)
tmp <- FSA::dunnTest(ACVmod~structure,data=LR_ACV_noNA,method="bh")
tmp$res$Comparison[which(tmp$res$P.adj<0.05)]

SUMLR_ACV_strux <- LR_ACV_noNA %>%
  group_by(structure) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","d","bc","b","bc","cd"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))
```

The distribution of ACV values, including APEs converted to ACVs when $R$=2, was strongly right-skewed (`r figs("Figure_ACVSUM",display="cite")`) with a median of `r RES(SUMLR_ACV_TABLE[1,"50%"])`% and 75% of values between 0 and `r RES(SUMLR_ACV_TABLE[1,"75%"])`%. Median ACV was lowest when otoliths were assessed (`r  RES(SUMLR_ACV_strux$mdn[1])`%) and highest when scales were assessed (`r RES(SUMLR_ACV_strux$mdn[2])`%) though the median ACV for scales was not significantly different than the median ACV for miscellaneous "other" structures (`r figs("Figure_ACVSUM",display="cite")`). The median ACV for finrays, spines, and vertebrae were intermediate between the median ACV of otoliths and scales at `r  RES(SUMLR_ACV_strux$mdn[4])`-`r  RES(SUMLR_ACV_strux$mdn[5])`% (`r figs("Figure_ACVSUM",display="cite")`).

```{r CALC_ACV_COMPS}
## Actinopteri Otoliths
LR_ACV_noNA_ActOtos <- LR_ACV_noNA %>%
  filter(class=="Actinopteri",structure=="Otoliths")

tmp <- kruskal.test(ACVmod~Rcat3,data=LR_ACV_noNA_ActOtos) ## difference

pKT_AO_R3 <- tibble(n=nrow(filter(LR_ACV_noNA_ActOtos,!is.na(Rcat3))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_AO_R3 <- LR_ACV_noNA_ActOtos %>%
  group_by(Rcat3) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","b"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- kruskal.test(ACVmod~type,data=LR_ACV_noNA_ActOtos) ## no diff

pKT_AO_TYPE <- tibble(n=nrow(filter(LR_ACV_noNA_ActOtos,!is.na(type))),
                      p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_AO_TYPE <- LR_ACV_noNA_ActOtos %>%
  group_by(type) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","a"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- kruskal.test(ACVmod~process2,
                            data=filter(LR_ACV_noNA_ActOtos,
                                        process2!="Unknown")) ## no diff
pKT_AO_PROC <- tibble(n=nrow(filter(LR_ACV_noNA_ActOtos,process2!="Unknown",
                                             !is.na(process2))),
                      p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_AO_PROC <- LR_ACV_noNA_ActOtos %>%
  filter(process2!="Unknown") %>%
  group_by(process2) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","a","a"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- mgcv::gam(ACVmod~s(log10(agemax)),
                       data=filter(LR_ACV_noNA_ActOtos,agemax>2))
pGAM_AO_AGEMAX <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))

tmp <- mgcv::gam(ACVmod~s(log10(n)),
                       data=filter(LR_ACV_noNA_ActOtos,n>=20))
pGAM_AO_n <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))


tmp <- mgcv::gam(ACVmod~s(log10(nperage)),
                       data=filter(LR_ACV_noNA_ActOtos,n>=20))
pGAM_AO_n2 <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))


## Actinopteri Scales
LR_ACV_noNA_ActScales <- LR_ACV_noNA %>%
  filter(class=="Actinopteri",structure=="Scales")

tmp <- kruskal.test(ACVmod~Rcat3,data=LR_ACV_noNA_ActScales) ## difference
pKT_AS_R3 <- tibble(n=nrow(filter(LR_ACV_noNA_ActScales,!is.na(Rcat3))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_AS_R3 <- LR_ACV_noNA_ActScales %>%
  group_by(Rcat3) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","b"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- kruskal.test(ACVmod~type,data=LR_ACV_noNA_ActScales) ## no diff
pKT_AS_TYPE <- tibble(n=nrow(filter(LR_ACV_noNA_ActScales,!is.na(type))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_AS_TYPE <- LR_ACV_noNA_ActScales %>%
  group_by(type) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","a"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- mgcv::gam(ACVmod~s(log10(agemax)),
                       data=filter(LR_ACV_noNA_ActScales,agemax>2))
pGAM_AS_AGEMAX <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))

tmp <- mgcv::gam(ACVmod~s(log10(n)),
                       data=filter(LR_ACV_noNA_ActScales,n>=20))
pGAM_AS_n <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))

tmp <- mgcv::gam(ACVmod~s(log10(nperage)),
                       data=filter(LR_ACV_noNA_ActScales,n>=20))
pGAM_AS_n2 <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))


## Elasmobranchii Vertebrae
LR_ACV_noNA_ElasmoVerts <- LR_ACV_noNA %>%
  filter(class=="Elasmobranchii",structure=="Vertebrae")

tmp <- kruskal.test(ACVmod~Rcat3,data=LR_ACV_noNA_ElasmoVerts)
pKT_EV_R3 <- tibble(n=nrow(filter(LR_ACV_noNA_ElasmoVerts,!is.na(Rcat3))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_EV_R3 <- LR_ACV_noNA_ElasmoVerts %>%
  group_by(Rcat3) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","a"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- kruskal.test(ACVmod~type,data=LR_ACV_noNA_ElasmoVerts)
pKT_EV_TYPE <- tibble(n=nrow(filter(LR_ACV_noNA_ElasmoVerts,!is.na(type))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_EV_TYPE <- LR_ACV_noNA_ElasmoVerts %>%
  group_by(type) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","b"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- kruskal.test(ACVmod~process2,
                            data=filter(LR_ACV_noNA_ElasmoVerts,
                                        !process2 %in% c("Unknown","Other"))) ## no diff
pKT_EV_PROC <- tibble(n=nrow(filter(LR_ACV_noNA_ElasmoVerts,!is.na(process2))),
                    p=FSA::kPvalue(tmp$p.value,latex=FALSE,digits=3))

SUMLR_EV_PROC <- LR_ACV_noNA_ElasmoVerts %>%
  filter(!process2 %in% c("Unknown","Other")) %>%
  group_by(process2) %>%
  summarize(n=n(),
            mdn=median(ACVmod),
            Q1=stats::quantile(ACVmod,probs=0.25),
            Q3=stats::quantile(ACVmod,probs=0.75)) %>%
  mutate(nlbl=paste0("n=",n),
         lets=c("a","a"),
         mdnlbl=paste0(formatC(mdn,format="f",digits=1)," (",lets,")"))

tmp <- mgcv::gam(ACVmod~s(log10(agemax)),data=LR_ACV_noNA_ElasmoVerts)
pGAM_EV_AGEMAX <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))

tmp <- mgcv::gam(ACVmod~s(log10(n)),data=LR_ACV_noNA_ElasmoVerts)
pGAM_EV_n <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))

tmp <- mgcv::gam(ACVmod~s(log10(nperage)),data=LR_ACV_noNA_ElasmoVerts)
pGAM_EV_n2 <- tibble(n=length(tmp$residuals),
                         p=FSA::kPvalue(anova(tmp)$s.table[1,"p-value"],
                                        latex=FALSE,digits=3),
                         lbl=paste0("n=",n,"\n",p))
```

The effects of various explanatory variables on ACV values were inconsistent among combinations of calcified structure and taxonomic class. For otolith assessments of Actinopteri fish (`r figs("Figure_ACV_Comps_AO",display="cite")`), median ACV was lower for two rather than more than two repeated interpretations (`r pKT_AO_R3$p`), did not differ between between- and within-interpreter comparisons (`r pKT_AO_TYPE$p`), showed a nonlinear relationship with maximum estimated age (`r pGAM_AO_AGEMAX$p`) primarily exhibited by a small peak for fish estimated at between approximately 4 and 9 years old, and was not related to the ratio of number of fish examined to range of estimated ages (`r pGAM_AO_n2$p`). For scale assessments of Actinopteri fish (`r figs("Figure_ACV_Comps_AS",display="cite")`), median ACV was also lower for two rather than more than two repeated interpretations (`r pKT_AS_R3$p`), also did not differ between between- and within-interpreter comparisons (`r pKT_AS_TYPE$p`), also showed a nonlinear relationship with maximum estimated age (`r pGAM_AS_AGEMAX$p`) but the small peak was later at between approximately 9 and 15 years old, and was generally negatively related to the ratio of number of fish examined to range of estimated ages (`r pGAM_AS_n2$p`). For vertebrae assessments of Elasmobranchii fish (`r figs("Figure_ACV_Comps_EV",display="cite")`), median ACV did not differ between two and more than two repeated interpretations (`r pKT_EV_R3$p`), was lower for within- than between-interpreter comparisons (`r pKT_EV_TYPE$p`), and was not significantly related to maximum estimated age (`r pGAM_EV_AGEMAX$p`) or the ratio of number of fish examined to range of estimated ages (`r pGAM_EV_n2$p`). Median ACV did not differ due to preparation methods for otoliths of Actinopteri (i.e., among whole, cracked, and ground or sectioned; `r pKT_AO_PROC$p`) or for vertebrae of Elasmobranchii (i.e., between whole and ground or sectioned; `r pKT_EV_PROC$p`).



[C]*Extended Analyses.*-- XXX

######## WILL BE FLESHED OUT

# [A]Discussion
## [B]Subsection

######## WILL BE FLESHED OUT


Don't lose this comment from Gordy ... Just a thought - may be interesting to note the findings of Albequerque et al. 2019 here or elsewhere - where precision (APE) was linearly correlated with latitude in Micropogonias furnieri. This may need backing from other studies though. 

# [A]Acknowledgments

######## WILL BE FLESHED OUT




# Figures

```{r Figure_n_by_continent, fig.width=fw1, fig.height=fh1}
ggplot(data=SUMLRBS_n_continent,mapping=aes(x=reorder(continent,-freq),
                                            y=freq,fill=USA)) +
  geom_bar(stat="identity",color="black",width=0.8,size=0.3) +
  scale_y_continuous(name="Number of Publications",
                     expand=expansion(mult=c(0,0.05))) +
  scale_x_discrete(name="Lead Author's Home Continent") +
  scale_fill_manual(values=c("USA"="gray30","Other"="gray70"),guide=FALSE) +
  annotate(geom="text",x=1,y=172/2,label="USA",color="white",angle=90,size=2.5)

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,"Number of publications in the literature review by the leaad author's home continent. North American publications with lead authors from the USA are highlighted.")
```

`r if (showFigLabels) figs("Figure_n_by_continent") else figs("Figure_n_by_continent",display="cite")`

\newpage

```{r Figure_n_by_year, fig.width=fw2, fig.height=fh2}
ggplot() +
  geom_bar(data=SUMLR_n_years,mapping=aes(x=pubyear,y=n,fill="Assessments"),
           stat="identity",color="black",width=0.8,size=0.3) +
  geom_bar(data=SUMLRBS_n_years,mapping=aes(x=pubyear,y=n,fill="Publications"),
           stat="identity",width=0.6,size=0.05) +
  scale_y_continuous(name="Frequency of Publications or Assessments",
                     expand=expansion(mult=c(0,0.1)),breaks=seq(0,100,10)) +
  scale_x_continuous(name="Publication Year",
                     expand=expansion(mult=0.02),breaks=seq(1995,2020,5)) +
  scale_fill_manual(values=c("Publications"="gray30","Assessments"="gray70")) +
  geom_segment(data=SUM_n_years5,mapping=aes(x=minyr-0.4,xend=maxyr+0.4,
                                               y=maxn+3,yend=maxn+3)) +
  geom_text(data=SUM_n_years5,
            mapping=aes(x=(minyr+maxyr)/2,y=maxn+3,label=nlbl),
            vjust=-0.1,size=3) +
  theme(legend.position=c(0,1),legend.justification=c(0,1),legend.box="none")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name= knitr::opts_current$get()$label,"Number of individual assessments and number of publications with precision assessments used in the literature review by year from 1996-2020. Total number of assessments and publications are also shown for five-year periods.")
```

`r if (showFigLabels) figs("Figure_n_by_year") else figs("Figure_n_by_year",display="cite")`

\newpage

```{r Figure_n_by_class_structure, fig.width=fw2, fig.height=fh1}
P1 <- ggplot(data=SUMLR_n_class_strux,
       mapping=aes(x=structure,y=n,fill=class)) +
  geom_bar(stat="identity",color="black",width=0.8,size=0.3) +
  scale_y_continuous(name="Frequency of Precision Assessments",
                     expand=expansion(mult=c(0,0.05))) +
  scale_x_discrete(name="Calcified Structure") +
  scale_fill_manual(values=c("Actinopteri"="gray70",
                             "Elasmobranchii"="gray30")) +
  theme(legend.position=c(1,1),legend.justification=c(1,1),legend.box="none")

P2 <- ggplot(data=SUMLR_n_class_strux_year5,mapping=aes(x=pubyear5,y=n,fill=structure)) +
  geom_bar(stat="identity",size=0.3,width=0.8,color="black",
           position=position_stack(reverse=TRUE)) +
  facet_wrap(vars(class),scales="free_y",nrow=2) +
  scale_y_continuous(name="Frequency of Precision Assessments",
                     expand=expansion(mult=c(0,0.07))) +
  scale_x_discrete(name="Publication Years") +
  scale_fill_manual(values=c("Otoliths"="gray10",
                             "Scales"="gray50",
                             "Vertebrae"="gray30",
                             "Spines"="gray70",
                             "Finrays"="gray90",
                             "Other"="white"),
                    guide=guide_legend(reverse=TRUE)) +
  theme(legend.position=c(0,1.05),legend.justification=c(0,1),legend.box="none",
        legend.key.size=unit(3,"mm"))

P1+P2 +
  plot_annotation(tag_levels="A")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Number of individual precision assessments by primary calcified structure type separated by major taxonomic class (A) and further separated by five-year periods (B).",FSA::kCounts(xclass[['Holocephali']],capitalize=TRUE),"assessments for Holocephali and",FSA::kCounts(xclass[['Petromyzonti']])," assessments for Petromyzonti are not included."))
```

`r if (showFigLabels) figs("Figure_n_by_class_structure") else figs("Figure_n_by_class_structure",display="cite")`

\newpage

```{r Figure_P_by_type_structure, fig.width=fw1, fig.height=fh1}
ggplot() +
  geom_bar(data=SUM_np_strux_type,mapping=aes(x=structure,y=perc,fill=type),
           stat="identity",position=position_stack(reverse=TRUE),
           color="black",width=0.8,size=0.3) +
  scale_y_continuous(name="Percentage of Precision Assessments",
                     expand=expansion(mult=c(0,0.04))) +
  scale_x_discrete(name="Calcified Structure") +
  scale_fill_manual(values=c("Between"="gray30","Within"="gray70")) +
  annotate(geom="text",x=1,y=100,label="Within",
           angle=90,size=2.5,hjust=1.1) +
  annotate(geom="text",x=1,y=0,label="Between",
           angle=90,size=2.5,color="white",hjust=-0.1) +
  geom_text(data=SUM_np_strux_type2,mapping=aes(x=structure,y=perc,label=plbl),
            vjust=-0.3,size=2.5) +
  geom_text(data=SUM_np_strux_type2,mapping=aes(x=structure,y=perc,label=lets),
            vjust=1.3,size=2.5,color="white") +
  geom_text(data=SUM_np_strux_type2,mapping=aes(x=structure,y=100,label=nlbl),
            vjust=-0.3,size=2.5) +
  theme(legend.position="none")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Percentage of individual precision assessments within calcified structure types that were within-interpreter assessments. Structures with the same letters have statistically equal percent of within-interpreter assessments. Overall sample size for each structure is shown above the bars.",FSA::kCounts(xtype[["Both"]],capitalize=TRUE),"observations that combined within- and between-interpreter assessments are not included."))
```

`r if (showFigLabels) figs("Figure_P_by_type_structure") else figs("Figure_P_by_type_structure",display="cite")`

\newpage

```{r Figure_Sum_R, fig.width=fw2, fig.height=fh1}
R1 <- ggplot(data=SUMLR_n_R,mapping=aes(x=Rcat4,y=freq,fill=Rcat4)) +
  geom_bar(stat="identity",color="black",width=0.8,size=0.3) +
  scale_x_discrete(name="R (Repeat Readings)") +
  scale_y_continuous(name="Frequency of Precision Assessments",
                     breaks=seq(0,900,100),
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(values=c("2"="gray20","3"="gray50","4+"="gray80")) +
#  annotate(geom="text",x=-Inf,y=Inf,label="A",hjust=-0.3,vjust=1.3,size=3.5) +
  theme(legend.position="none")

R2 <- ggplot() +
  geom_bar(data=SUMLR_n_R_year5,mapping=aes(x=pubyear5,y=perc,fill=Rcat4),
           stat="identity",color="black",width=0.8,size=0.3,
           position=position_stack(reverse=TRUE)) +
  scale_x_discrete(name="Publication Year",expand=expansion(mult=0.15)) +
  scale_y_continuous(name="Percentage of Precision Assessments",
                     expand=expansion(mult=c(0,0.07))) +
  scale_fill_manual(values=c("2"="gray20","3"="gray50","4+"="gray80")) +
  geom_text(data=SUMLR_n_R_year5a,mapping=aes(x=pubyear5,y=100,label=nlbl),
            vjust=-0.3,size=2.5) +
  annotate(geom="text",x=1,y=58/2,label="R=2",size=2.5,color="white") +
  annotate(geom="text",x=1,y=58+42/2,label="R=3",size=2.5) +
  annotate(geom="text",x=5,y=100-8.75/2,label="R=4+",size=2.5) +
#  annotate(geom="text",x=-Inf,y=Inf,label="B",hjust=-0.3,vjust=1.3,size=3.5) +
  theme(legend.position="none")

R1 + R2 +
  plot_annotation(tag_levels="A")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Number of individual precision assessments by the number of repeat interpretations (A) and further separated by five-year period (B). The maximum number of repeated interpretations was $R$=9."))
```

`r if (showFigLabels) figs("Figure_Sum_R") else figs("Figure_Sum_R",display="cite")`

\newpage

```{r Figure_MetricsUsed, fig.width=fw2, fig.height=fh1}
P1 <- ggplot(data=SUMLRBS_P_Metrics,mapping=aes(x=Metric,y=Freq)) +
  geom_bar(stat="identity",color="black",fill="gray70",width=0.8,size=0.3) +
  scale_x_discrete(name="Precision Metric") +
  scale_y_continuous(name="Number of Studies",expand=expansion(mult=c(0,0.05))) +
  geom_text(mapping=aes(label=plbl),vjust=-0.4,size=2.5)

P2 <- ggplot(data=SUMLRBS_P_Metrics2) +
  geom_bar(mapping=aes(x=Metric,y=Percent,fill=CUSE),
           stat="identity",color="black",width=0.8,size=0.3,
           position=position_stack(reverse=TRUE)) +
  scale_x_discrete(name="Precision Metric") +
  scale_y_continuous(name="Percentage of Studies",expand=expansion(mult=c(0,0.01))) +
  geom_text(mapping=aes(x=Metric,y=clbly,label=clbl,color=CUSE),size=2.5) +
  scale_fill_manual(values=c("alone"="gray30","other"="gray70")) +
  scale_color_manual(values=c("alone"="white","other"="black")) +
  theme(legend.position="none")

P1 + P2 +
  plot_annotation(tag_levels="A")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Number of publications that used each of the main precision metrics (A) and the percentage of publications using each metric separated by how the metric was used relative to the other main metrics (B). Note that $PA$=Percent Agreement, $ACV$=Average Coefficient of Variation, $APE$=Average Percent Error, $AD$=Average Index of Precision."))
```

`r if (showFigLabels) figs("Figure_MetricsUsed") else figs("Figure_MetricsUsed",display="cite")`

\newpage

```{r Figure_MetricsUsed_Year, fig.width=fw1, fig.height=fh1}
ggplot(data=SUMLRBS_P_Metrics3,mapping=aes(x=pubyear5,y=Percent,
                                           group=Metric,color=Metric)) +
  geom_line(mapping=aes(linetype=Metric),size=1.25) +
  geom_point(pch=21,fill="white",size=1.25) +
  scale_x_discrete(name="Publication Year") +
  scale_y_continuous(name="Percentage of Studies",breaks=seq(20,80,10)) +
  scale_color_manual(values=c("p_ACV"="black",
                              "p_APE"="gray50","p_APE_noACV"="gray50")) +
  scale_linetype_manual(values=c("p_ACV"="solid",
                                 "p_APE"="solid","p_APE_noACV"="dashed")) +
  annotate(geom="text",x=3.25,y=73,label="Used ACV",size=2.5) +
  annotate(geom="text",x=3.2,y=47,label="Used APE",size=2.5) +
  annotate(geom="text",x=3.9,y=22,label="Used APE without ACV",size=2.5) +
  theme(legend.position="none")
  
fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Percentage of publications that used the Average Coefficient of Variation ($ACV$), Average Percent Error ($APE$), or the $APE$ alone without also using the $ACV$ by five-year period."))
```

`r if (showFigLabels) figs("Figure_MetricsUsed_Year") else figs("Figure_MetricsUsed_Year",display="cite")`

\newpage

```{r Figure_ACVSUM, fig.width=fw2, fig.height=fh1}
lbl <- paste0("n=",SUMLR_ACV$n[1],"\n10th=",RES(SUMLR_ACV$D1[1]),
              "\n25th=",RES(SUMLR_ACV$Q1[1]),"\n50th=",RES(SUMLR_ACV$mdn[1]),
              "\n75th=",RES(SUMLR_ACV$Q3[1]),"\n90th=",RES(SUMLR_ACV$D9[1]))

P1 <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA,mapping=aes(x=ACVmod),
                       fill="gray70",adjust=0.5,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA,mapping=aes(x=ACVmod,y=0),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.01)) +
  geom_point(data=SUMLR_ACV[1,],mapping=aes(y=0,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.025)) +
  geom_text(data=SUMLR_ACV[1,],mapping=aes(y=0,x=mdn,label=RES(mdn)),
            size=2.5,position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_ACV[1,],mapping=aes(y=0,yend=0,x=Q1,xend=Q3),
               size=1) +
  scale_y_continuous(name="Density",expand=expansion(mult=0.01)) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  annotate(geom="text",x=Inf,y=Inf,label=lbl,vjust=1.2,hjust=1.2,size=2.5) +
  theme(axis.text.y=element_blank())

P2 <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA,mapping=aes(y=structure,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA,mapping=aes(y=structure,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_ACV_strux,mapping=aes(y=structure,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_ACV_strux,
               mapping=aes(y=structure,yend=structure,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_ACV_strux,mapping=aes(y=structure,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_ACV_strux,mapping=aes(y=structure,x=Inf,label=nlbl),
            nudge_y=0.075,vjust=-0.5,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Calcified Structure",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

P1 + P2 +
  plot_annotation(tag_levels="A")

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Density distribution and individual values (vertical marks) of Average Coefficient of Variation ($ACV$) values for all assessments (A) and for assessments by main calcified structure type (B). The median value is shown and marked with a triangle. The inter-quartile range (first to third quartile) is shown by the black horizontal bar. Calcified structures with different letters have significantly different medians. These $ACV$ values include all Average Percent Error ($APE$) values for two interpretations ($R$=2) converted to $ACV$ values."))
```

`r if (showFigLabels) figs("Figure_ACVSUM") else figs("Figure_ACVSUM",display="cite")`

\newpage

```{r Figure_ACV_Comps_AO, fig.width=fw2, fig.height=1.5*fh1}
PRAO <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ActOtos,mapping=aes(y=Rcat3,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ActOtos,mapping=aes(y=Rcat3,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_AO_R3,mapping=aes(y=Rcat3,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_AO_R3,
               mapping=aes(y=Rcat3,yend=Rcat3,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_AO_R3,mapping=aes(y=Rcat3,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_AO_R3,mapping=aes(y=Rcat3,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_AO_R3,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="R (Repeat Readings)",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PTAO <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ActOtos,mapping=aes(y=type,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ActOtos,mapping=aes(y=type,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_AO_TYPE,mapping=aes(y=type,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_AO_TYPE,
               mapping=aes(y=type,yend=type,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_AO_TYPE,mapping=aes(y=type,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_AO_TYPE,mapping=aes(y=type,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_AO_TYPE,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Comparison",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PPAO <- ggplot() + 
  ggdist::stat_halfeye(data=filter(LR_ACV_noNA_ActOtos,process2!="Unknown"),
                       mapping=aes(y=process2,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=filter(LR_ACV_noNA_ActOtos,process2!="Unknown"),
             mapping=aes(y=process2,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_AO_PROC,mapping=aes(y=process2,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_AO_PROC,
               mapping=aes(y=process2,yend=process2,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_AO_PROC,mapping=aes(y=process2,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_AO_PROC,mapping=aes(y=process2,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_AO_PROC,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Comparison",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PAMAO <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActOtos,agemax>2),
              mapping=aes(x=agemax,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActOtos,
             mapping=aes(x=agemax,y=ACVmod,shape=agemax>2),
             alpha=0.2) +
  geom_text(data=pGAM_AO_AGEMAX,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Maximum Estimated Age",trans="log10",
                     breaks=c(1,2,5,10,20,50,100)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))
  
PNAO <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActOtos,n>=20),
              mapping=aes(x=n,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActOtos,
             mapping=aes(x=n,y=ACVmod,shape=n>=20),
             alpha=0.3) +
  geom_text(data=pGAM_AO_n,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Sample Size (n)",trans="log10",
                     breaks=c(10,20,50,100,200,500,1000,2000)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))

PN2AO <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActOtos,n>=20),
              mapping=aes(x=nperage,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActOtos,
             mapping=aes(x=nperage,y=ACVmod,shape=n>=20),
             alpha=0.3) +
  geom_text(data=pGAM_AO_n2,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Structures Examined Divided by Range of Ages",trans="log10",
                     breaks=c(1,2,5,10,20,50,100,200,500,1000,2000)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))

## Don't show PPA0 (no diff here or with elasmobranchii) or PNA0
PRAO + PTAO + PAMAO + PN2AO +
  plot_annotation(tag_levels="A") +
  plot_layout(ncol=2,widths=c(1,1),heights=c(1.5,3))

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                     height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Density distribution and individual values (vertical marks) of Average Coefficient of Variation ($ACV$) values for all assessments by number of repeated interpretations (A) and comparison type (B), and the relationship between $ACV$ and maximum estimated age (C) and sample size (D) for otoliths of Actinopteri. The median $ACV$ value is shown and marked with a triangle and the inter-quartile range (first to third quartile) is shown by the black horizontal bar in panels A and B. Assessments with different letters in the same panel have significantly different medians. The significance of the GAM smoother is shown in panels C and D. Estimated ages less than 3 and number of structures examined less than 20 were excluded from the respective GAM models and are marked with asterisks. A log scale is used for the x-axis in panels C and D."))
```

`r if (showFigLabels) figs("Figure_ACV_Comps_AO") else figs("Figure_ACV_Comps_AO",display="cite")`



\newpage

```{r Figure_ACV_Comps_AS, fig.width=fw2, fig.height=1.5*fh1}
PRAS <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ActScales,mapping=aes(y=Rcat3,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ActScales,mapping=aes(y=Rcat3,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_AS_R3,mapping=aes(y=Rcat3,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_AS_R3,
               mapping=aes(y=Rcat3,yend=Rcat3,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_AS_R3,mapping=aes(y=Rcat3,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_AS_R3,mapping=aes(y=Rcat3,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_AS_R3,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="R (Repeat Readings)",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PTAS <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ActScales,mapping=aes(y=type,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ActScales,mapping=aes(y=type,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_AS_TYPE,mapping=aes(y=type,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_AS_TYPE,
               mapping=aes(y=type,yend=type,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_AS_TYPE,mapping=aes(y=type,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_AS_TYPE,mapping=aes(y=type,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_AS_TYPE,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Comparison",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PAMAS <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActScales,agemax>2),
              mapping=aes(x=agemax,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActScales,
             mapping=aes(x=agemax,y=ACVmod,shape=agemax>2),
             alpha=0.2) +
  geom_text(data=pGAM_AS_AGEMAX,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Maximum Estimated Age",trans="log10",
                     breaks=c(1,2,5,10,20,50,100)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))
  
PNAS <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActScales,n>=20),
              mapping=aes(x=n,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActScales,
             mapping=aes(x=n,y=ACVmod,shape=n>=20),
             alpha=0.3) +
  geom_text(data=pGAM_AS_n,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Sample Size (n)",trans="log10",
                     breaks=c(10,20,50,100,200,500,1000,2000)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))

PN2AS <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ActScales,n>=20),
              mapping=aes(x=nperage,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ActScales,
             mapping=aes(x=nperage,y=ACVmod,shape=n>=20),
             alpha=0.3) +
  geom_text(data=pGAM_AS_n2,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Structures Examined Divided by Range of Ages",trans="log10",
                     breaks=c(1,2,5,10,20,50,100,200,500,1000,2000)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(-5,50))

## Don't show PNAS
PRAS + PTAS + PAMAS + PN2AS +
  plot_annotation(tag_levels="A") +
  plot_layout(ncol=2,widths=c(1,1),heights=c(1.5,3))

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                     height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Density distribution and individual values (vertical marks) of Average Coefficient of Variation ($ACV$) values for all assessments by number of repeated interpretations (A) and comparison type (B), and the relationship between $ACV$ and maximum estimated age (C) and sample size (D) for scales of Actinopteri. The median $ACV$ value is shown and marked with a triangle and the inter-quartile range (first to third quartile) is shown by the black horizontal bar in panels A and B. Assessments with different letters in the same panel have significantly different medians. The significance of the GAM smoother is shown in panels C and D. Estimated ages less than 3 and number of structures examined less than 20 were excluded from the respective GAM models and are marked with asterisks. A log scale is used for the x-axis in panels C and D."))
```

`r if (showFigLabels) figs("Figure_ACV_Comps_AS") else figs("Figure_ACV_Comps_AS",display="cite")`


\newpage

```{r Figure_ACV_Comps_EV, fig.width=fw2, fig.height=1.5*fh1}
PRE <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(y=Rcat3,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(y=Rcat3,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_EV_R3,mapping=aes(y=Rcat3,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_EV_R3,
               mapping=aes(y=Rcat3,yend=Rcat3,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_EV_R3,mapping=aes(y=Rcat3,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_EV_R3,mapping=aes(y=Rcat3,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_EV_R3,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="R (Repeat Readings)",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PTE <- ggplot() + 
  ggdist::stat_halfeye(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(y=type,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(y=type,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_EV_TYPE,mapping=aes(y=type,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_EV_TYPE,
               mapping=aes(y=type,yend=type,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_EV_TYPE,mapping=aes(y=type,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_EV_TYPE,mapping=aes(y=type,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_EV_TYPE,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Comparison",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PPE <- ggplot() + 
  ggdist::stat_halfeye(data=filter(LR_ACV_noNA_ElasmoVerts,
                                   !process2 %in% c("Unknown","Other")),
                       mapping=aes(y=process2,x=ACVmod),
                       fill="gray70",adjust=0.5,height=0.9,justification=0,
                       .width=0,point_colour=NA,slab_color="gray60") +
  geom_point(data=filter(LR_ACV_noNA_ElasmoVerts,
                                   !process2 %in% c("Unknown","Other")),
             mapping=aes(y=process2,x=ACVmod),
             shape=108,size=2,alpha=0.3,position=position_nudge(y=-0.05)) +
  geom_point(data=SUMLR_EV_PROC,mapping=aes(y=process2,x=mdn),
             shape=25,size=1,fill="black",position=position_nudge(y=0.075)) +
  geom_segment(data=SUMLR_EV_PROC,
               mapping=aes(y=process2,yend=process2,x=Q1,xend=Q3),
               size=1) +
  geom_text(data=SUMLR_EV_PROC,mapping=aes(y=process2,x=mdn,label=mdnlbl),
            nudge_y=0.075,vjust=-0.5,hjust=0.5,size=2.5) +
  geom_text(data=SUMLR_EV_PROC,mapping=aes(y=process2,x=Inf,label=nlbl),
            nudge_y=0.3,vjust=1,hjust=1.5,size=2.5) +
  geom_text(data=pKT_EV_PROC,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=2,hjust=1.5,size=2.5) +
  scale_y_discrete(name="Process",limits=rev) +
  scale_x_continuous(name="ACV (%)",expand=expansion(mult=0.01),limits=c(0,50)) +
  coord_cartesian(ylim=c(1.4,NA),clip="off")

PAME <- ggplot() +
  geom_smooth(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(x=agemax,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(x=agemax,y=ACVmod),
             alpha=0.2) +
  geom_text(data=pGAM_EV_AGEMAX,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Maximum Estimated Age",trans="log10",
                     breaks=c(5,6,7,8,9,10,12,15,20,25,30)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  coord_cartesian(ylim=c(0,50))
  
PNE <- ggplot() +
  geom_smooth(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(x=n,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ElasmoVerts,mapping=aes(x=n,y=ACVmod),
             alpha=0.3) +
  geom_text(data=pGAM_EV_n,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Sample Size (n)",trans="log10",
                     breaks=c(25,50,100,200,300,500,750)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  coord_cartesian(ylim=c(0,50))

PN2E <- ggplot() +
  geom_smooth(data=filter(LR_ACV_noNA_ElasmoVerts,n>=20),
              mapping=aes(x=nperage,y=ACVmod),
              color="black",fill="gray80") +
  geom_point(data=LR_ACV_noNA_ElasmoVerts,
             mapping=aes(x=nperage,y=ACVmod,shape=n>=20),
             alpha=0.3) +
  geom_text(data=pGAM_EV_n2,mapping=aes(y=Inf,x=Inf,label=p),
            vjust=3,hjust=1.5,size=2.5) +
  scale_x_continuous(name="Structures Examined Divided by Range of Ages",trans="log10",
                     breaks=c(1,2,5,10,20,50,100,200,500,1000,2000)) +
  scale_y_continuous(name="ACV (%)",expand=expansion(mult=0.01)) +
  scale_shape_manual(values=c("TRUE"=19,"FALSE"=8),guide=FALSE) +
  coord_cartesian(ylim=c(0,50))

## Don't show PPE (no diff here or Actinopteri) or PNE
PRE + PTE + PAME + PN2E +
  plot_annotation(tag_levels="A") +
  plot_layout(ncol=2,widths=c(1,1),heights=c(1.5,3))

fn <- file.path(wdir,"docs","Figs",knitr::opts_current$get()$label)
if (saveTIFFs) ggsave(file=paste0(fn,".tiff"),dpi=300,scale=1,
                      width=knitr::opts_current$get()$fig.width,
                      height=knitr::opts_current$get()$fig.height,units="in")
if (savePDFs) ggsave(file=paste0(fn,".pdf"),dpi=1000,scale=1,
                     width=knitr::opts_current$get()$fig.width,
                     height=knitr::opts_current$get()$fig.height,units="in")
figs(name=knitr::opts_current$get()$label,paste("Density distribution and individual values (vertical marks) of Average Coefficient of Variation ($ACV$) values for all assessments by number of repeated interpretations (A) and comparison type (B), and the relationship between $ACV$ and maximum estimated age (C) and sample size (D) for vertebrae of Elasmobranchii. The median $ACV$ value is shown and marked with a triangle and the inter-quartile range (first to third quartile) is shown by the black horizontal bar in panels A and B. Assessments with different letters in the same panel have significantly different medians. The significance of the GAM smoother is shown in panels C and D. Number of structures examined less than 20 were excluded from the respective GAM models and are marked with asterisks. A log scale is used for the x-axis in panels C and D."))
```

`r if (showFigLabels) figs("Figure_ACV_Comps_EV") else figs("Figure_ACV_Comps_EV",display="cite")`


```{asis, echo=!showFigLabels}
\newpage
# Figure Captions
```

`r if (!showFigLabels) figs("Figure_n_by_continent")`

`r if (!showFigLabels) figs("Figure_n_by_year")`

`r if (!showFigLabels) figs("Figure_n_by_class_structure")`

`r if (!showFigLabels) figs("Figure_P_by_type_structure")`

`r if (!showFigLabels) figs("Figure_Sum_R")`

`r if (!showFigLabels) figs("Figure_MetricsUsed")`

`r if (!showFigLabels) figs("Figure_MetricsUsed_Year")`

`r if (!showFigLabels) figs("Figure_ACVSUM")`

`r if (!showFigLabels) figs("Figure_ACV_Comps_AO")`

`r if (!showFigLabels) figs("Figure_ACV_Comps_AS")`

`r if (!showFigLabels) figs("Figure_ACV_Comps_EV")`

\newpage


# [A]References

######## Need to fix species capitalization

